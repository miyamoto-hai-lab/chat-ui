# yaml-language-server: $schema=config.schema.json
# ======================================================================================================
# Chat UI Configuration File
#
# すべての設定値は "file://<プロジェクトルートからのファイルパス>" を指定することでファイルから読み込むことも可能です。
# ファイルから読み込む場合はUTF-8で，各ファイルには値のみを記載してください。
# ======================================================================================================

# ------------------------------------------------------------------------------------------------------
# プレースホルダー（変数）について
# 設定値の一部では、${キー名} の形式で値を動的に埋め込むことが可能です。
#
# ■ 基本的な挙動
# URLクエリパラメータの値が埋め込まれます。（例: ?id=123 → ${id} は 123 に置換）
#
# ■ 特殊な変数: ${PASSWORD}
# `password_auth` が有効な場合、入力されたパスワードに置換されます。
# （パスワードが未入力の時点では '' (空文字列) となります。）
# ※競合や意図しない動作を防ぐため、URLクエリパラメータのキー名には "PASSWORD" を使用しないでください。
#
# ■ 変換オプション
# キー名の前に記号をつけることで、値をBase64変換できます。
# - ${#key} または ${e#key}     : Base64エンコード（失敗時は置換されない）
# - ${u#key}                   : URL-Safe Base64エンコード（失敗時は置換されない）
# - ${d#key}                   : Base64デコード（失敗時は生の値を返す）
# ------------------------------------------------------------------------------------------------------

# このアプリがホスティングされているパス
# 例：
#   - htmlのルートフォルダにホスティングされている場合：
#     base_path: "" もしくは base_path: "/" 
#   - サブフォルダにホスティングされている場合：
#     base_path: "/chat"
base_path: ""

# ------------------------------------------
# 1. アプリケーション基本情報 (App)
# ------------------------------------------
app:
  # ブラウザのタブやヘッダーに表示されるタイトル
  title: "Chat UI"
  
  # 画面に表示する説明文や被験者への指示（Markdown対応を想定）
  # 空白の場合は表示されません
  description: ""

# ------------------------------------------
# 2. LLM設定 (LLM)
# ------------------------------------------
llm:
  # --- デフォルト設定 ---
  # ユーザーが変更可能な項目において、ブラウザに保存された設定がない場合の初期値として機能します。
  # ユーザー変更が不可（permissionsでfalse）の場合は、この設定が強制されます。
  defaults:
    # endpoint_url, model, api_key, system_promptでプレースホルダが利用可能です
    provider: "openai" # options: openai, gemini, anthropic, grok, deepseek
    endpoint_url: ""   # 空の場合は各プロバイダのデフォルトが使用されます
    model: ""          # 空の場合は各プロバイダのデフォルトモデルが使用されます
    api_key: ""        # 配布用などで埋め込む場合。空の場合はユーザー入力が必要
    system_prompt: | # システムプロンプトをなしにしたい場合は""を指定するかコメントアウトしてください
      あなたは有能なアシスタントです。ユーザーの質問に対して丁寧に答えてください。
    enable_thinking: true # Thinking（思考プロセス）の表示/非表示

  # --- ユーザー権限 (Permissions) ---
  # ユーザーが設定画面で値を変更できるかどうかを制御します。
  permissions:
    allow_change_config: true    # プロバイダ、URL、モデル、APIキーの変更許可
    allow_change_system_prompt: true
    allow_toggle_thinking: true  # ユーザーがThinkingの表示/非表示を切り替えられるか

# ------------------------------------------
# 3. チャットの挙動と制限 (Chat Flow)
# ------------------------------------------
chat:
  # 会話の開始者
  # user: ユーザーが最初のメッセージを送る
  # assistant: ページを開くと同時にLLMから挨拶などが生成される
  start_role: "user" 

  # 最大ターン数 (0: 無制限, ユーザとLLMの発話1回ずつで1ターンです)
  max_turns: 0

  # 最大ターン到達時の挙動 (Completion Behavior)
  on_limit_reached:
    # 到達時のアクション
    # modal: 全画面でメッセージと退出ボタンを表示（操作不能にする）
    # inline: チャットの最後にメッセージと退出ボタンを表示
    # none: 何も表示しない（会話だけ止まる）
    action: "modal"
    
    # 自動退出（秒数）
    # 0: 自動退出しない
    # n: n秒後に指定のリダイレクト先へ、またはタブを閉じる等の処理
    auto_exit_delay_sec: 0
  
  # 退出時のリダイレクト先URL（空の場合はChat UIを再読み込み）
  # プレースホルダが利用可能です
  exit_redirect_url: ""

  # 初期メッセージ
  # ユーザがページを開いた時にあらかじめ表示され、このメッセージの後から対話がスタートします
  # prefill_messages:
  # - role: "user"
  #   text: "こんにちは！"
  # - role: "assistant"
  #   text: "こんにちは！何かお手伝いできることはありますか？"

# ------------------------------------------
# 4. ユーザーインターフェース (UI)
# ------------------------------------------
ui:
  # --- スタイル設定 ---
  styles:
    # 返答生成中の表示スタイル
    # streaming: 逐次表示 (stream: true を使用します)
    # spinner: 生成が完了するまでアニメーションを表示 -> 完了後に一括表示
    # read: メッセージ送信直後に既読マーク表示 -> 生成完了後に一括表示
    # instant: 生成が完了したら一括表示
    generation_style: "streaming"

    # メッセージの吹き出しスタイル
    # bubble: LINEのような吹き出しとアイコン
    # flat: ChatGPTのようなアイコンと横並びのテキスト
    message_style: "bubble"

  # --- 表示コンポーネント ---
  components:
    # ヘッダー右上の退出ボタンの表示ルール
    # always: 常に表示
    # on_limit: 最大ターン数に達した時のみ表示
    # never: 表示しない
    exit_button_visibility: "always"

    # 設定画面でのインポート/エクスポートボタン
    allow_import: true
    allow_export: true

  # --- ターン数の表示 ---
  turn_counter:
    # 表示形式
    # hidden: 表示なし
    # fraction: "n / N" 形式 (例: 5/10)
    # custom: "n / 任意の文字列" 形式
    style: "fraction"
    
    # styleが 'custom' の場合に使用されるサフィックス
    # 例: "/ 10 (上限)" と設定すると "5 / 10 (上限)" と表示
    # custom_label: ""

  # --- ファイル出力 ---
  export:
    # ダウンロード時のファイル名プレフィックス
    # 例: "chatlog" -> "chatlog_2026-01-01_12-00-00.json"
    filename_prefix: "chatlog"

# ------------------------------------------
# 5. システム・ログ・認証 (System)
# ------------------------------------------
system:
  # --- パスワード認証 ---
  security:
    password_auth_enabled: false
    # 認証サーバーURL
    # url, headers, bodyでプレースホルダが利用可能です
    auth_request: 
      url: "https://api.your-server.com/auth"
      method: "POST" # GET or POST
      headers:
        "Content-Type": "application/json"
        # ボディ（JSON文字列としてパース可能な記述、または固定値）
        body: '{"password": "${PASSWORD}", "base64password": "${#PASSWORD}"}'

  # --- 操作ログ送信 ---
  logging:
    # ログ送信先URL
    endpoint_url: "https://api.your-server.com/logger"
    
    # 送信するイベント（配列で複数指定）
    # options: KEY_INPUT, CHAT_MESSAGE
    target_events: []

  # --- ハートビート (死活監視) ---
  heartbeat:
    # url, headers, bodyでプレースホルダが利用可能です
    enabled: false
    interval_sec: 30
    url: "https://api.your-server.com/heartbeat" # クエリパラメータも可能
    method: "POST" # "GET" or "POST"
    headers:
      "Content-Type": "application/json"
      "Authorization": "Bearer ${PASSWORD}"
    # ボディ（JSON文字列としてパース可能な記述、または固定値）
    body: '{"status": "alive"}'