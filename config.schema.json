{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Chat UI Configuration",
  "type": "object",
  "properties": {
    "base_path": {
        "type": "string",
        "description": "このアプリがホスティングされているパス",
        "default": "/"
    },
    "app": {
      "type": "object",
      "properties": {
        "title": { "type": "string", "description": "ブラウザのタブやヘッダーに表示されるタイトル" },
        "description": {
          "anyOf": [
            { "type": "string", "description": "画面に表示する説明文や指示（Markdown対応）" },
            {
              "type": "object",
              "properties": {
                "contents": { "type": "string", "description": "Markdownテキスト" },
                "position": { 
                  "type": "string", 
                  "enum": ["top", "bottom", "left", "right"],
                  "default": "top",
                  "description": "表示位置"
                },
                "width": { 
                  "type": "string", 
                  "default": "16rem",
                  "description": "サイドバー表示時の幅 (CSS値)"
                },
                "style": {
                  "type": "string",
                  "enum": ["fixed", "floating"],
                  "default": "fixed",
                  "description": "表示スタイル (fixed: サイドバー固定, floating: フローティング)"
                },
                "max_height": { 
                  "type": "string", 
                  "default": "12rem",
                  "description": "最大高さ (CSS値)"
                }
              },
              "required": ["contents"]
            }
          ]
        }
      },
      "required": ["title"]
    },
    "llm": {
      "type": "object",
      "properties": {
        "provider": { "type": "string", "enum": ["openai", "azure", "anthropic", "google", "local"] },
        "endpoint_url": { "type": "string" },
        "model": { "type": "string" },
        "api_key": { "type": "string" },
        "system_prompt": { "type": "string" },
        "enable_thinking": { "type": "boolean" },
        "thinking_tags": {
          "type": "array",
          "description": "思考過程として扱うタグのペア",
          "items": {
            "type": "object",
            "required": ["start", "end"],
            "properties": {
              "start": { "type": "string", "description": "開始タグ" },
              "end": { "type": "string", "description": "終了タグ" }
            }
          }
        },
        "permissions": {
          "type": "object",
          "properties": {
            "allow_change_config": { "type": "boolean" },
            "allow_change_system_prompt": { "type": "boolean" },
            "allow_toggle_thinking": { "type": "boolean" }
          },
          "required": ["allow_change_config", "allow_change_system_prompt"]
        }
      },
      "required": ["provider", "model", "permissions"]
    },
    "chat": {
      "type": "object",
      "properties": {
        "start_role": { "type": "string", "enum": ["user", "assistant"] },
        "max_turns": { "type": "integer", "minimum": 1 },
        "on_limit_reached": {
          "type": "object",
          "properties": {
            "action": { "type": "string", "enum": ["modal", "inline", "none"] },
            "auto_exit_delay_sec": { "type": "number", "minimum": 0 },
            "modal_delay_sec": {
              "type": "number",
              "default": 1.0,
              "description": "モーダル表示までの遅延時間（秒）"
            }
          },
          "required": ["action", "auto_exit_delay_sec"]
        },
        "exit_redirect_url": { "type": "string" },
        "prefill_messages": {
          "type": "array",
          "description": "初期表示されるメッセージのリスト",
          "items": {
            "type": "object",
            "required": ["role", "text"],
            "properties": {
              "role": {
                "type": "string",
                "enum": ["user", "assistant"],
                "description": "メッセージの送信者ロール"
              },
              "text": {
                "type": "string",
                "description": "メッセージの本文"
              },
              "reasoning": {
                "type": "string",
                "description": "思考過程のテキスト（オプション）"
              }
            }
          }
        },
        "user_name": {
          "type": "string",
          "description": "ユーザーの表示名（吹き出しの上に表示）"
        },
        "assistant_name": {
          "type": "string",
          "description": "アシスタントの表示名（吹き出しの上に表示）"
        }
      },
      "required": ["start_role", "max_turns", "on_limit_reached", "exit_redirect_url"]
    },
    "ui": {
      "type": "object",
      "properties": {
        "styles": {
          "type": "object",
          "properties": {
            "generation_style": { "type": "string", "enum": ["streaming", "spinner", "read", "instant"] },
            "message_style": { "type": "string", "enum": ["bubble", "flat"] }
          },
          "required": ["generation_style", "message_style"]
        },
        "components": {
          "type": "object",
          "properties": {
            "exit_button_visibility": {
              "anyOf": [
                { "type": "string", "enum": ["always", "on_limit", "never"] },
                { "type": "integer", "minimum": 0 }
              ]
            },
            "allow_import": { "type": "boolean" },
            "allow_export": { "type": "boolean" },
            "candidates": {
              "type": "object",
              "properties": {
                "show_turn": { "type": "integer", "minimum": 0 },
                "hide_turn": { "type": "integer", "minimum": 0 },
                "before_show_text": { "type": "string" },
                "after_hide_text": { "type": "string" },
                "used_contents_behavior": { "type": "string", "enum": ["none", "move_to_end", "remove"] },
                "contents": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              },
              "required": ["show_turn", "hide_turn", "contents"]
            }
          },
          "required": ["exit_button_visibility", "allow_import", "allow_export"]
        },
        "turn_counter": {
          "type": "object",
          "properties": {
            "style": { "type": "string", "enum": ["hidden", "fraction", "custom"] },
            "custom_suffix": { "type": "string" }
          },
          "required": ["style"]
        },
        "export": {
          "type": "object",
          "properties": {
            "filename_prefix": { "type": "string" },
            "include_settings": { 
              "type": "boolean",
              "description": "エクスポートデータに現在のllm設定を含めるかどうか",
              "default": false
            }
          },
          "required": ["filename_prefix"]
        },
        "theme": {
          "type": "object",
          "description": "テーマ設定",
          "properties": {
            "base": {
              "type": "string",
              "enum": ["light", "dark", "system"],
              "description": "ベーステーマ"
            },
            "colors": {
              "type": "object",
              "description": "カスタムカラー設定",
              "properties": {
                "background": { "type": "string", "description": "全体の背景色" },
                "user_bubble": { "type": "string", "description": "ユーザー吹き出しの色" },
                "user_bubble_text": { "type": "string", "description": "ユーザー吹き出しの文字色" },
                "assistant_bubble": { "type": "string", "description": "アシスタント吹き出しの色" },
                "assistant_bubble_text": { "type": "string", "description": "アシスタント吹き出しの文字色" }
              }
            }
          }
        }
      },
      "required": ["styles", "components", "turn_counter", "export"]
    },
    "system": {
      "type": "object",
      "properties": {
        "security": {
          "type": "object",
          "properties": {
            "password_auth_enabled": { "type": "boolean" },
            "auth_request": {
              "type": "object",
              "properties": {
                "url": { "type": "string" },
                "method": { "type": "string", "enum": ["GET", "POST", "PUT"] },
                "headers": { "type": "object" },
                "body": { "type": "string" }
              },
              "required": ["url"]
            }
          },
          "required": ["password_auth_enabled"]
        },
        "logging": {
          "type": "object",
          "properties": {
            "endpoint_url": { "type": "string" },
            "target_events": { "type": "array", "items": { "type": "string" } }
          }
        },
        "heartbeat": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "interval_sec": { "type": "integer" },
            "url": { "type": "string" },
            "method": { "type": "string", "enum": ["GET", "POST", "PUT"] },
            "headers": { "type": "object" },
            "body": { "type": "string" }
          }
        }
      }
    }
  },
  "required": ["app", "llm", "chat", "ui"]
}